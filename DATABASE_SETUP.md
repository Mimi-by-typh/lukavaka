# Настройка базы данных

## Текущая ситуация

Сейчас все данные (комментарии, пользователи) хранятся в памяти и **теряются** при перезапуске функций Vercel.

## Решение: Vercel KV (Redis)

Vercel KV - это управляемый Redis от Vercel, который идеально подходит для serverless функций.

### Шаг 1: Создание KV базы данных через Marketplace

1. Перейдите в [Vercel Dashboard](https://vercel.com/dashboard)
2. Выберите ваш проект
3. Перейдите в раздел **Storage** или **Marketplace**
4. Найдите **KV** (Redis) в Marketplace
5. Нажмите **Add Integration** или **Create**
6. Введите название (например: `lika-frizz-db`)
7. Выберите регион (ближайший к вам)
8. Нажмите **Create** или **Add**

**Альтернативный способ:**
- Перейдите в **Marketplace** → найдите **KV**
- Или используйте прямую ссылку: [Vercel Marketplace - KV](https://vercel.com/marketplace)

### Шаг 2: Получение переменных окружения

После создания KV базы данных, Vercel автоматически добавит переменные окружения:
- `KV_URL` - URL подключения
- `KV_REST_API_URL` - REST API URL
- `KV_REST_API_TOKEN` - Токен для REST API
- `KV_REST_API_READ_ONLY_TOKEN` - Токен только для чтения

### Шаг 3: Установка зависимостей

```bash
npm install @vercel/kv
```

### Шаг 4: Использование

Код уже обновлен для работы с Vercel KV. Просто перезапустите деплой после настройки KV.

## Альтернативные варианты

### MongoDB Atlas (бесплатный тариф)

1. Создайте аккаунт на [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Создайте бесплатный кластер
3. Получите connection string
4. Добавьте в переменные окружения Vercel: `MONGODB_URI`

### Vercel Postgres

1. В Vercel Dashboard → **Marketplace**
2. Найдите **Postgres** в Marketplace
3. Нажмите **Add Integration** или **Create**
4. Следуйте инструкциям для создания базы данных
5. Используйте переменные окружения, которые Vercel создаст автоматически

**Примечание:** Postgres подходит для более сложных запросов и связей между данными, но требует больше настроек чем KV.

## Что хранится в базе данных

- **Комментарии** - все комментарии пользователей
- **Пользователи** - информация о зарегистрированных пользователях (опционально)
- **Онлайн сессии** - активные сессии пользователей
- **Настройки** - настройки приложения

## Важно

⚠️ После настройки KV базы данных, все данные будут сохраняться между перезапусками.

⚠️ Для продакшена рекомендуется использовать MongoDB или PostgreSQL для более сложных запросов.

